(window.webpackJsonp=window.webpackJsonp||[]).push([["legacy-analytics~e2550e02"],{"VG8/":function(e,t,n){"use strict";n.r(t);var r=n("pkwY"),o=n("EfWO"),i=n.n(o),a=n("kD2R"),s=n("pLw3"),c=n.n(s),l=n("r9hL"),u=n("7LQG"),h=n("f6W2"),d=n("bfgX"),m=n("zjfJ"),v=n("Jygk"),f=n.n(v),p=n("kC4U");function _(e){const t=Date.now();return function(e){return e.filter(e=>{let t=null;return g(e.name)?g(e.properties)&&e.properties.constructor!==Object&&(t="properties must be an object with key value pairs."):t="you must provide a name for the event.",null===t||(console.log("WARN: Invalid analytics event detected and ignored, ".concat(t,"\nEvent: ").concat(JSON.stringify(e))),!1)})}(e).map((e,n,r)=>{let o;return o=e.time>0?e.time-t:n-r.length,{name:e.name,properties:b(e.properties),timeDelta:o}})}function b(e){if(!e)return null;for(const t in e)if(e.hasOwnProperty(t)){const n=e[t];g(n)&&y(n)||(g(n)&&n.toString?e[t]=n.toString():e[t]="")}return e}function g(e){return null!=e}function y(e){return"number"==typeof e||"string"==typeof e||"boolean"==typeof e}var E,w={},S=window,j=S.document;if(w.disabled=!1,w.set=function(e,t){},w.get=function(e){},w.remove=function(e){},w.clear=function(){},w.transact=function(e,t){var n=w.get(e);void 0===n&&(n={}),t(n),w.set(e,n)},w.serialize=function(e){return JSON.stringify(e)},w.deserialize=function(e){if("string"==typeof e)return JSON.parse(e)},function(){try{return"localStorage"in S&&S.localStorage}catch(e){return!1}}())E=S.localStorage,w.set=function(e,t){if(void 0===t)return w.remove(e);E.setItem(e,w.serialize(t))},w.get=function(e){return w.deserialize(E.getItem(e))},w.remove=function(e){E.removeItem(e)},w.clear=function(){E.clear()};else if(function(){try{return"globalStorage"in S&&S.globalStorage&&S.globalStorage[S.location.hostname]}catch(e){return!1}}())E=S.globalStorage[S.location.hostname],w.set=function(e,t){if(void 0===t)return w.remove(e);E[e]=w.serialize(t)},w.get=function(e){return w.deserialize(E[e]&&E[e].value)},w.remove=function(e){delete E[e]},w.clear=function(){for(var e in E)delete E[e]};else if(j.documentElement.addBehavior){var O,P;try{(P=new ActiveXObject("htmlfile")).open(),P.write('<script>document.w=window<\/script><iframe src="/favicon.ico"></frame>'),P.close(),O=P.w.frames[0].document,E=O.createElement("div")}catch(e){E=j.createElement("div"),O=j.body}function k(e){return function(){var t=Array.prototype.slice.call(arguments,0);t.unshift(E),O.appendChild(E),E.addBehavior("#default#userData"),E.load("localStorage");var n=e.apply(w,t);return O.removeChild(E),n}}w.set=k((function(e,t,n){if(void 0===n)return w.remove(t);e.setAttribute(t,w.serialize(n)),e.save("localStorage")})),w.get=k((function(e,t){return w.deserialize(e.getAttribute(t))})),w.remove=k((function(e,t){e.removeAttribute(t),e.save("localStorage")})),w.clear=k((function(e){var t=e.XMLDocument.documentElement.attributes;e.load("localStorage");for(var n,r=0;n=t[r];r++)e.removeAttribute(n.name);e.save("localStorage")}))}try{w.set("__storejs__","__storejs__"),"__storejs__"!=w.get("__storejs__")&&(w.disabled=!0),w.remove("__storejs__")}catch(e){w.disabled=!0}var A=w;var z=class{constructor({contextPath:e,product:t,eventEmitter:n}){if(Object(m.a)(this,"_retryCount",0),Object(m.a)(this,"_scheduledPublish",null),Object(m.a)(this,"_events",[]),Object(m.a)(this,"listen",()=>{this._eventEmitter.bind("analytics",this._pushEventFromEmitter),this._eventEmitter.bind("analyticsEvent",this._pushEventFromEmitter),f.a.addEventListener("unload",this._addEventsToStore);const e=this._getEventsFromStore();A.remove(this._storageKey),e.length&&(this._addEvents(e),this._debouncedPublish())}),Object(m.a)(this,"push",e=>{this._addEvents([e]),this._debouncedPublish()}),Object(m.a)(this,"_pushEventFromEmitter",(e,t)=>{this.push({name:t.name,properties:t.data})}),Object(m.a)(this,"_addEventsToStore",()=>{const e=this._getEventsFromStore();A.set(this._storageKey,e.concat(this._events))}),!t)throw new Error("You must provide a product when constructing an AnalyticsClient.");this._contextPath=e||"",this._eventEmitter=n,this._storageKey="atlassian-analytics.".concat(t)}_getEventsFromStore(){const e=A.get(this._storageKey);return Array.isArray(e)?e:[]}_addEvents(e){e.forEach(e=>{this._events.push({name:e.name,properties:e.properties,time:e.time||Date.now()})})}_removeEvents(e){this._events=this._events.slice(e.length)}_debouncedPublish(){var e;null===this._scheduledPublish&&(this._scheduledPublish=f.a.setTimeout(()=>this._bulkPublish().then(e=>{this._scheduledPublish=null,this._retryCount=e?0:this._retryCount+1,this._events.length&&this._debouncedPublish()}),(e=this._retryCount,Math.min(5e3*Math.pow(2,e),3e5))))}_bulkPublish(){const e=[...this._events],t=_(e);if(!t.length)return this._events.length=0,Promise.resolve(!0);const n=f.a.document.querySelector("meta[name=atlassian-token]");return Object(p.a)("".concat(this._contextPath,"/rest/analytics/1.0/publish/bulk"),{headers:{atl_token:n?n.content:"","content-type":"application/json"},method:"POST",body:JSON.stringify(t),ignoreNoNetworkError:!0}).catch(()=>({ok:!1})).then(({ok:t})=>(t&&this._removeEvents(e),t))}};function C(e,t){new z({contextPath:u.a,product:"confluence",eventEmitter:{bind:d.a}}).listen();const n=c.a.fromUrl(location.href);if(t&&!n.isEmpty()){e.dispatch(Object(l.a)("confluence.page.with-atl-origin.viewed",Object(r.a)({},n.toAnalyticsAttributes())));const{pathname:t,query:o,search:s,hash:u}=i.a.parse(c.a.removeFromUrl(location.href)),d=Object(h.a)(e.getState()),m=Object(r.a)({},d,{pathname:t,search:s,query:o,hash:u});e.dispatch(Object(a.replace)(m)),e.dispatch(Object(l.a)("confluence.spa.analytics.smoke"))}}n.d(t,"setupLegacyAnalytics",(function(){return C}))}}]);
//# sourceMappingURL=legacy-analytics~e2550e02.F22YT5KP-v39.js.map