WRMCB=function(e){var c=console;if(c&&c.log&&c.error){c.log('Error running batched script.');c.error(e);}}
;
try {
/* module-key = 'confluence.macros.advanced:jiraroadmap-editor', location = 'com/atlassian/confluence/plugins/macros/advanced/jiraroadmap/templates.soy' */
// This file was automatically generated from templates.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace Confluence.Templates.JiraRoadmapMacro.
 */

if (typeof Confluence == 'undefined') { var Confluence = {}; }
if (typeof Confluence.Templates == 'undefined') { Confluence.Templates = {}; }
if (typeof Confluence.Templates.JiraRoadmapMacro == 'undefined') { Confluence.Templates.JiraRoadmapMacro = {}; }


Confluence.Templates.JiraRoadmapMacro.roadmapPopupPanel = function(opt_data, opt_ignored) {
  return '<section id="confluence-jira-roadmap-dialog" class="jiraroadmap jiraroadmap-dialog" class="aui-dialog2 aui-dialog2-xlarge aui-layer" role="dialog" aria-hidden="true"><header class="aui-dialog2-header"><h2 class="aui-dialog2-header-main">' + soy.$$escapeHtml('Jira roadmap') + '</h2></header><div class="aui-dialog2-content"><div class="dialog-content"><form action="" onsubmit="return false" class="aui"><div class="field-group select-tenant"><div class="field-label">' + soy.$$escapeHtml('Paste a Jira instance URL') + '</div><input id="tenant-select" type="text" class="text" /><div class="error" id="error-tenant"></div></div><div class="field-group select-project"><div class="field-label">' + soy.$$escapeHtml('Project') + '</div><input id="project-select" /><div class="error" id="error-project"></div></div></form><div tabindex="-1" id="roadmap-preview" class="jiraroadmap-iframe-container"></div></div></div><footer class="aui-dialog2-footer"><div class="aui-dialog2-footer-actions"><form onsubmit="return false" class="aui"><a tabindex="0" id="insert-jira-roadmap-dialog" class="aui-button aui-button-primary">' + soy.$$escapeHtml('Save') + '</a><a tabindex="0" class="close-jira-roadmap-dialog aui-button aui-button-link">' + soy.$$escapeHtml('Cancel') + '</a></form></div></footer></section>';
};
if (goog.DEBUG) {
  Confluence.Templates.JiraRoadmapMacro.roadmapPopupPanel.soyTemplateName = 'Confluence.Templates.JiraRoadmapMacro.roadmapPopupPanel';
}


Confluence.Templates.JiraRoadmapMacro.roadmapError = function(opt_data, opt_ignored) {
  return '<div class="error-screen"><div class="message" id="preview-error-message">' + ((opt_data.type == 'permission') ? '<h2>' + soy.$$escapeHtml('You don\x27t have permission to view this Jira roadmap.') + '</h2><p>' + soy.$$escapeHtml('Please check the project settings in Jira.') + '</p><br/><a href="' + soy.$$escapeHtml(opt_data.link) + '" target="_blank" tabindex="0" class="aui-button aui-button-primary">' + soy.$$escapeHtml('Go to Jira') + '</a><a href="https://confluence.atlassian.com/adminjiracloud/managing-project-permissions-776636362.html" target="_blank" tabindex="0" class="aui-button aui-button-link">' + soy.$$escapeHtml('Learn more') + '</a>' : (opt_data.type == 'validation' || opt_data.type == 'not-available') ? '<h2>' + soy.$$escapeHtml('We can\x27t display this Jira roadmap.') + '</h2><p>' + soy.$$escapeHtml('Please check with your system administrator.') + '</p><br/><a href="' + soy.$$escapeHtml(opt_data.link) + '" target="_blank" tabindex="0" class="aui-button aui-button-primary">' + soy.$$escapeHtml('Go to Jira') + '</a><a href="https://confluence.atlassian.com/jirasoftwarecloud/roadmap-957979308.html#Roadmap-TroubleshootyourRoadmap" target="_blank" tabindex="0" class="aui-button aui-button-link">' + soy.$$escapeHtml('Learn more') + '</a>' : (opt_data.type == 'invalid-url') ? '<h2>' + soy.$$escapeHtml('This doesn\x27t look like a URL of Jira roadmap.') + '</h2><p>' + soy.$$escapeHtml('Please check with your system administrator.') + '</p><br/>' : (opt_data.type == 'inconsistent-env') ? '<h2>' + soy.$$escapeHtml('We can\x27t display this Jira roadmap.') + '</h2><p>' + soy.$$escapeHtml('This Jira roadmap is in a different environment.') + '</p>' : (opt_data.type == 'project-type') ? '<h2>' + soy.$$escapeHtml('We can\x27t display this Jira roadmap.') + '</h2><p>' + soy.$$escapeHtml('This macro only supports next-gen Jira Software projects.') + '</p>' : (opt_data.type == 'service-unavailable') ? '<h2>' + soy.$$escapeHtml('We can\x27t display this Jira roadmap.') + '</h2><p>' + soy.$$escapeHtml('Try again later, or contact Atlassian Support if this keeps happening.') + '</p><br/><a href="https://support.atlassian.com/contact/#/" target="_blank" tabindex="0" class="aui-button aui-button-primary">' + soy.$$escapeHtml('Atlassian Support') + '</a>' : '<h2>' + soy.$$escapeHtml('This Jira roadmap is not currently active.') + '</h2><p>' + soy.$$escapeHtml('Please check with your system administrator.') + '</p><br/><a href="' + soy.$$escapeHtml(opt_data.link) + '" target="_blank" tabindex="0" class="aui-button aui-button-primary">' + soy.$$escapeHtml('Go to Jira') + '</a><a href="https://confluence.atlassian.com/jirasoftwarecloud/roadmap-957979308.html" target="_blank" tabindex="0" class="aui-button aui-button-link">' + soy.$$escapeHtml('Learn more') + '</a>') + '</div></div>';
};
if (goog.DEBUG) {
  Confluence.Templates.JiraRoadmapMacro.roadmapError.soyTemplateName = 'Confluence.Templates.JiraRoadmapMacro.roadmapError';
}


Confluence.Templates.JiraRoadmapMacro.roadmapIframe = function(opt_data, opt_ignored) {
  return '<iframe id="roadmap-iframe" src="' + soy.$$escapeHtml(opt_data.iframeSrc) + '" width="100%" frameBorder="0" />' + ((opt_data.roadmapUrl != '') ? '<div class="preview-footer"><a class="aui-button aui-button-link" target="_blank" href="' + soy.$$escapeHtml(opt_data.roadmapUrl) + '">' + soy.$$escapeHtml('View in Jira') + '</a></div>' : '');
};
if (goog.DEBUG) {
  Confluence.Templates.JiraRoadmapMacro.roadmapIframe.soyTemplateName = 'Confluence.Templates.JiraRoadmapMacro.roadmapIframe';
}


Confluence.Templates.JiraRoadmapMacro.roadmapLoading = function(opt_data, opt_ignored) {
  return '<div class="jiraroadmap-loading"><div class="spinner-container"><div class="spinner"><svg focusable="false" size="50" height="50" width="50" viewBox="0 0 50 50"><circle cx="25" cy="25" r="22.5"></circle></svg></div></div></div>';
};
if (goog.DEBUG) {
  Confluence.Templates.JiraRoadmapMacro.roadmapLoading.soyTemplateName = 'Confluence.Templates.JiraRoadmapMacro.roadmapLoading';
}

}catch(e){WRMCB(e)};
;
try {
/* module-key = 'confluence.macros.advanced:jiraroadmap-editor', location = 'com/atlassian/confluence/plugins/macros/advanced/jiraroadmap/jiraroadmap-editor.js' */
define("confluence-advanced-macros/jiraroadmap-editor","jquery ajs aui/dialog2 confluence/templates confluence/macro-js-overrides confluence-macro-browser/macro-browser-facade confluence/api/event confluence/dark-features".split(" "),function(e,n,t,r,F,G,H,I){return{init:function(){F.put("jiraroadmap",{opener:function(f){function s(c,d){var b=new XMLHttpRequest;b.open("GET",c);b.withCredentials=true;b.onload=function(){l=false;if(b.status===200){var c=JSON.parse(b.responseText);d({data:c,status:b.status})}else try{d({data:null,
error:JSON.parse(b.responseText),status:b.status})}catch(a){d({data:null,error:null,status:b.status})}};b.onerror=function(){l=false;d({data:null,error:null,status:b.status})};b.send()}function j(c){var d="";switch(c){case "invalid-url":d="This doesn\'t look like a URL of Jira roadmap.";h.auiSelect2({data:{id:"",text:""},dropdownCssClass:p});break;case "inconsistent-env":d="This Jira roadmap is in a different environment.";h.auiSelect2({data:{id:"",
text:""},dropdownCssClass:p});break;case "project-type":d="This macro only supports next-gen Jira Software projects.";break;case "service-unavailable":d="Try again later, or contact Atlassian Support if this keeps happening.";h.auiSelect2({data:{id:"",text:""},dropdownCssClass:p});break;default:d=""}q.html(d)}function x(c,d){return c&&d?c+"/rest/greenhopper/1.0/roadmap/fragment/confluenceMacro/"+d+"?fragmentHost="+window.location.protocol+"//"+window.location.hostname:null}
function y(c,d,b){return d?I.isEnabled("jira.roadmap.macro.new-url")?c+"/jira/software/projects/"+d+"/boards/"+b+"/roadmap":b?c+"/secure/Roadmap.jspa?projectKey="+d+"&rapidView="+b:c+"/secure/Roadmap.jspa?projectKey="+d:c}function z(c){var d=["jira-dev.com","localhost","atl-test.space"],b=window.location.hostname,a=d.filter(function(b){return c.indexOf(b)>-1}),d=d.filter(function(c){return b.indexOf(c)>-1});return a.length>0===d.length>0}function A(){i.empty();var c=r.JiraRoadmapMacro.roadmapLoading();
e(c).appendTo(i)}function k(c,d,b){c=r.JiraRoadmapMacro.roadmapError({link:c,type:b});e(c).appendTo(d);H.trigger("analyticsEvent",{name:"confluence.advanced.macro.jiraroadmap.error-"+b})}function B(c,d,b){q.html("");s(c+"/rest/greenhopper/1.0/roadmap/fragment/bootstrap/"+d+"?fragmentHost="+C,function(a){i.empty();if(a&&a.data&&a.data.hasActiveJiraSoftwareLicense)if(a.data.validation&&a.data.validation&&a.data.validation.hasAllFieldAssociations&&a.data.validation.hasStartDateCustomField&&a.data.validation.hasEpicIssueType&&
a.data.validation.hasValidHierarchy&&a.data.validation.isRoadmapFeatureEnabled){var o=x(c,d),a=y(c,d,a.data.boardId),o=r.JiraRoadmapMacro.roadmapIframe({iframeSrc:o+"&hideHeader=true",roadmapUrl:a});e(o).appendTo(b);g.removeAttr("disabled")}else if(a.data.validation&&a.data.validation.isRoadmapFeatureEnabled){g.attr("disabled",true);k(c,b,"not-available")}else{o=c+"/projects/"+d+"/settings";g.attr("disabled",true);k(o,b,"validation")}else{g.attr("disabled",true);if(a.status===503)k(c,b,"service-unavailable");
else if(a.error&&a.error.errorMessages)switch(a.error.errorMessages.length>0?a.error.errorMessages[0]:""){case "You must have the browse project permission to view this project.":k(c,b,"permission");break;case "This project is not a next-gen Jira Software project.":k(c,b,"project-type");break;default:k(c,b,"not-available")}else k(c,b,"not-available")}})}function D(a){var d=/[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)/g;if(a&&a.url&&a.url!==""&&a.url.match(d)!==
null){var b=a.url,d=document.createElement("a");d.href=b.indexOf("://")>-1?b:"https://"+b;var b=/(?:\?|&)projectKey=([\w][\w]+)(?:&rapidView=(\d+))?/g,e=/(?:.+)\/jira\/software\/projects\/([\w][\w]+)\/boards\/(\d+)\/roadmap/g,b=d.href.indexOf("Roadmap.jspa")>-1?b.exec(d.search):e.exec(d.href);if((d={tenant:"https://"+d.hostname,project:b&&b[1]?b[1]:null,boardId:b&&b[2]?b[2]:null})&&d.tenant){b=x(d.tenant,d.project);return{url:a.url,iframeUrl:b,tenant:d.tenant,project:d.project,boardId:d.boardId}}}return null}
function E(c,d){if(!l){l=true;A();g.attr("disabled",true);s(c+"/rest/greenhopper/1.0/roadmap/fragment/cloudId?fragmentHost="+C,function(b){if(b&&b.data&&b.data.cloudId){l=false;u=b.data.cloudId;var c="/gateway/api/ex/jira/"+u+"/rest/api/3/project/search?typeKey=software";q.html("");d?v(c,d,true):s(c,function(b){if(b&&b.data&&b.data.values&&b.data.values.length>0){a.project=b.data.values[0].key;v(c,a.project,false)}else v(c,"",false)})}else{l=false;i.empty();b.status===503?j("service-unavailable"):
j("invalid-url")}})}}function v(c,d,b){h.auiSelect2("destroy");h.unbind().change(function(){a.project=h.auiSelect2("val");if(a.tenant&&a.project){A();B(a.tenant,a.project,i)}}).auiSelect2({minimumInputLength:0,multiple:false,ajax:{data:function(a){return{query:a}},dataType:"json",url:c,results:function(a){var b=[];if(a.values)for(var a=a.values.filter(function(a){return a.style==="next-gen"}),c=0;c<a.length;c++)b.push({id:a[c].key,text:a[c].name+"("+a[c].key+")"});return{results:b}},params:{xhrFields:{withCredentials:true},
error:function(){var a=e(".select2-drop-active > .select2-results"),b="No result found.";a.html('<li class="select2-no-results">'+b+"</li>")}},cache:true,quietMillis:300},dropdownCssClass:p});h.auiSelect2("data",{id:d,text:d});if(a.tenant&&d){var f=function(b){if(b.isSimplified)B(a.tenant,d,i);else{i.empty();g.attr("disabled",true);b.isSimplified===false?j("project-type"):b.status===503?j("service-unavailable"):j("invalid-url")}};b?s("/gateway/api/ex/jira/"+
u+"/rest/api/3/project/"+d,function(a){f({isSimplified:a&&a.data&&a.data.simplified,status:a.status})}):f({isSimplified:true,status:200})}}var p="jiraroadmap-macro-dropdown",w=r.JiraRoadmapMacro.roadmapPopupPanel(),C=window.location.protocol+"//"+window.location.hostname,l=false,a,u,g,m,h,i,q;e("#confluence-jira-roadmap-dialog").length>0&&e("#confluence-jira-roadmap-dialog").remove();a=D(f.params);f=e(w).appendTo(e("body"));t("#confluence-jira-roadmap-dialog").show();g=e("#insert-jira-roadmap-dialog",
f);w=e(".close-jira-roadmap-dialog",f);m=e("#tenant-select",f);h=e("#project-select",f);i=e("#roadmap-preview",f);q=e("#error-tenant",f);g.unbind().click(function(){if(a&&a.tenant&&a.project){G.insert({name:"jiraroadmap",params:{url:y(a.tenant,a.project,a.boardId)}});t("#confluence-jira-roadmap-dialog").hide()}});w.unbind().click(function(){t("#confluence-jira-roadmap-dialog").hide()});m.unbind().keyup(function(a,d){var b;return function(){var e=this,f=arguments;if(b){clearTimeout(b);b=void 0}b=setTimeout(function(){a.apply(e,
f);b=void 0},d)}}(function(){if(e(this).val().length>0){var c=D({url:e(this).val()});if(!c||!c.tenant||!z(c.tenant)){c&&c.tenant?j("inconsistent-env"):j("invalid-url");i.empty();g.attr("disabled",true);a=null;return false}q.html("");if(!a||a&&c.tenant!==a.tenant||a&&c.project&&c.project!==a.project){a={tenant:c.tenant,project:c.project,boardId:c.boardId};E(a.tenant,a.project);m.val(a.tenant)}else c.tenant&&!c.project&&m.val(a.tenant)}},500));h.auiSelect2({data:[{id:a&&a.project?a.project:"",text:a&&
a.project?a.project:""}],dropdownCssClass:p});if(a&&a.url){if(a.tenant){m.val(a.tenant);if(z(a.tenant))E(a.tenant,a.project);else{j("inconsistent-env");g.attr("disabled",true);a=null}}}else{g.removeAttr("disabled");m.focus()}}})}}});require("confluence/module-exporter").safeRequire("confluence-advanced-macros/jiraroadmap-editor",function(e){require("ajs").toInit(function(){e.init()})});
}catch(e){WRMCB(e)};