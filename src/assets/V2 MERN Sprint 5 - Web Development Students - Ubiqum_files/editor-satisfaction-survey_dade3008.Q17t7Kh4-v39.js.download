(window.webpackJsonp=window.webpackJsonp||[]).push([["editor-satisfaction-survey~dade3008"],{"2v6S":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));const n=[{name:"terrible",id:0,value:1},{name:"bad",id:1,value:2},{name:"okay",id:2,value:3},{name:"great",id:3,value:4},{name:"amazing",id:4,value:5}]},JOcB:function(e,t,i){"use strict";i.d(t,"a",(function(){return c}));var n=i("cxan"),s=i("HbGN"),a=i("zjfJ"),o=i("ERkP"),r=i.n(o),u=i("gQ5V");i("aWzz");class c extends o.Component{constructor(...e){super(...e),Object(a.a)(this,"_queryResults",[]),Object(a.a)(this,"_queryProperties",[]),Object(a.a)(this,"_anyLoading",()=>this._queryResults.some(e=>!0===e.loading)),Object(a.a)(this,"_renderQueryComponent",(e,t,i)=>e.length?r.a.createElement(u.b,Object(n.a)({errorPolicy:"all"},e[i]),n=>{let{data:a,loading:o,error:r}=n,u=Object(s.a)(n,["data","loading","error"]);this._queryResults[i]={data:a,loading:o,error:r},this._queryProperties[i]=u;const c=i+1;return e.length>c?this._renderQueryComponent(e,t,c):t({results:this._queryResults,loading:this._anyLoading(),properties:this._queryProperties})}):t({results:[],loading:!1}))}render(){const{queryProps:e,children:t}=this.props;return this._renderQueryComponent(e,t,0)}}c.displayName="QueryGroup"},WbO6:function(e,t,i){"use strict";i.r(t);var n=i("zjfJ"),s=i("ERkP"),a=i.n(s),o=i("lZoD"),r=i("JOcB"),u=i("/FQd"),c=i("fDrt"),d=i("X2PC"),l=i("pkwY"),b=i("HbGN"),p=i("L21V"),h=i("2sr0"),m=i("cGYM"),y=i("2v6S"),f=i("ntAl");const v={"meeting-notes":!0,decisions:!0,"kb-how-to-article":!0,"file-list":!0,retrospective:!0,requirements:!0,"shared-links":!0,"kb-troubleshooting-article":!0,"task-report":!0,jirareport:!0};var S=i("WlwD"),g=i("tqyq");function E(){S.b.setItemQuietly(g.a.EDITOR_SURVEY_LAST_SUBMITTED,Date.now(),"")}const T=Object(p.g)({questionBad:{id:"editor-satisfaction-survey.question.bad",defaultMessage:"We're sorry to hear that. What went wrong? (optional)",description:"Prompt for user to follow up on negative response"},questionGood:{id:"editor-satisfaction-survey.question.good",defaultMessage:"Thanks! What did you like about it? What could be improved? (optional)",description:"Prompt for user to follow up on positive response"},reaction_amazing:{id:"editor-satisfaction-survey.reaction.amazing",defaultMessage:"Amazing",description:"hover tooltip for corresponding emoji"},reaction_bad:{id:"editor-satisfaction-survey.reaction.bad",defaultMessage:"Bad",description:"hover tooltip for corresponding emoji"},reaction_great:{id:"editor-satisfaction-survey.reaction.great",defaultMessage:"Great",description:"hover tooltip for corresponding emoji"},reaction_okay:{id:"editor-satisfaction-survey.reaction.okay",defaultMessage:"Okay",description:"hover tooltip for corresponding emoji"},reaction_terrible:{id:"editor-satisfaction-survey.reaction.terrible",defaultMessage:"Terrible",description:"hover tooltip for corresponding emoji"},surveyTitle:{id:"editor-satisfaction-survey.title",defaultMessage:"Your page has been published",description:"title of survey form"},surveyFinalTitle:{id:"editor-satisfaction-survey.final.title",defaultMessage:"Thank you",description:"title after finishing survey"},buttonSubmit:{id:"editor-satisfaction-survey.button.submit",defaultMessage:"Submit",description:"Button text to submit responses"},buttonClose:{id:"editor-satisfaction-survey.button.close",defaultMessage:"Close",description:"Button text to close survey modal"}});const j=Object.keys(v),O=Object(p.h)(Object(h.a)()(class extends s.PureComponent{constructor(...e){super(...e),Object(n.a)(this,"state",{shouldShowSurvey:Boolean(this.props.shouldShowSurvey)}),Object(n.a)(this,"autoHideFinalTimeout",void 0),Object(n.a)(this,"analyticsFired",!1),Object(n.a)(this,"handleAction",e=>{const{markSubmitted:t,markLastSubmitted:i,hasBeenSubmitted:n}=this.props;n||this.analyticsFired||(this.fireAnalytics(e),t(),i(),this.analyticsFired=!0),e.dismissed&&this.closeSurvey()}),Object(n.a)(this,"isDismissed",!1),Object(n.a)(this,"closeSurvey",()=>{this.isDismissed||(this.props.closeSurvey(),this.setState({shouldShowSurvey:!1}),this.isDismissed=!0,clearTimeout(this.autoHideFinalTimeout))}),Object(n.a)(this,"fireAnalytics",e=>{let{reaction:t="",feedback:i=""}=e,n=Object(b.a)(e,["reaction","feedback"]);const{isFabricPage:s,contentType:a,blueprintType:o,createAnalyticsEvent:r,testCohorts:u,experimentFeatures:c}=this.props,d=y.a.indexOf(t)+1,p={contentType:Object(m.c)("page","blogpost")(a),editorVersion:Object(m.c)("fabric","tinymce")(s?"fabric":"tinymce"),reaction:d,feedback:Object(m.a)(i)};o&&(p.blueprintType=Object(m.c)(...j)(o)),n.cohorts||(n.cohorts=u),n.experiments||(n.experiments=c),Object.keys(n).forEach(e=>{p[e]=Object(m.a)(n[e])}),r({type:"sendUIEvent",data:{source:"viewPageScreen",action:"submit",actionSubject:"confluence.spa.editor.fabric.satisfaction",attributes:Object(l.a)({},p)}}).fire()})}componentDidUpdate(e){const{hasBeenSubmitted:t,shouldShowSurvey:i,wasTinyMCEPageJustPublished:n}=this.props,{contentId:s,openSurvey:a}=e;e.hasBeenSubmitted!==t&&!0===t&&(this.autoHideFinalTimeout=window.setTimeout(this.closeSurvey,2e3)),e.shouldShowSurvey!==i&&!0===i&&(this.isDismissed=!1,this.analyticsFired=!1),e.wasTinyMCEPageJustPublished!==n&&!0===n&&(S.b.removeItem(g.a.TINYMCE_PAGE_JUST_PUBLISHED),a(s))}componentWillUnmount(){clearTimeout(this.autoHideFinalTimeout),this.props.closeSurvey()}render(){const{shouldShowSurvey:e,hasBeenSubmitted:t,intl:{formatMessage:i}}=this.props;if(!e)return null;const n=i(T.questionBad),s=i(T.questionGood),o=[n,n,s,s,s],r=y.a.map(e=>i(T["reaction_".concat(e.name)]));return a.a.createElement(f.a,{title:i(T.surveyTitle),description:a.a.createElement(p.c,{id:"editor-satisfaction-survey.description",defaultMessage:"How was your editing experience?",description:"Question in survey about the editor"}),finalTitle:i(T.surveyFinalTitle),finalDescription:a.a.createElement(p.c,{id:"editor-satisfaction-survey.final.description",defaultMessage:"Your feedback has been submitted"}),reactionTitles:r,formQuestions:o,isOnFinalStage:t,onInteraction:this.handleAction,submitButtonText:i(T.buttonSubmit),closeButtonText:i(T.buttonClose)})}}));var w=i("KD1n"),P=i("H5qd"),k=i.n(P);function _(){const e=Object(w.a)(["\n  query EditorSatisfactionSurveyQuery($contentId: ID) {\n    content(id: $contentId) {\n      nodes {\n        id\n        type\n        metadata {\n          labels {\n            id\n            name\n          }\n        }\n      }\n    }\n  }\n"]);return _=function(){return e},e}const M=k()(_());function I(){const e=Object(w.a)(["\n  query ExperimentFeaturesQuery {\n    spaViewModel {\n      experimentFeatures\n      abTestCohorts\n    }\n  }\n"]);return I=function(){return e},e}const B=k()(I());var C=i("xXmr");i.d(t,"EditorSatisfactionSurvey",(function(){return q}));class q extends s.PureComponent{constructor(...e){super(...e),Object(n.a)(this,"lastSubmitted",Date.now()),Object(n.a)(this,"wasTinyMCEPageJustPublished",!1)}async componentDidMount(){const e=await async function(){const e=await S.b.getItem(g.a.EDITOR_SURVEY_LAST_SUBMITTED);return e?parseInt(e,10):0}(),t=await async function(){return"true"===await S.b.getItem(g.a.TINYMCE_PAGE_JUST_PUBLISHED)}();this.lastSubmitted=e,this.wasTinyMCEPageJustPublished=t}render(){const{contentId:e,isFabricPage:t}=this.props;if(!e)return null;const i=[{query:M,variables:{contentId:e}},{query:B}];return a.a.createElement(c.a,{attribution:d.a.CONTENT_EXPERIENCE},a.a.createElement(r.a,{queryProps:i},({results:[i,n],loading:s})=>{var r,c,d;const l=null!=(d=i.data)&&null!=(d=d.content)&&null!=(d=d.nodes)?d[0]:d;if(i.error||s||!l)return null;const b=l.metadata&&l.metadata.labels||[],p=l.type,h=b.find(e=>{if(e&&e.name)return v[e.name]});let m="";h&&h.name&&(m=h.name);const y=n.data,f=(null!=(c=y)&&null!=(c=c.spaViewModel)?c.experimentFeatures:c)||"{}",S=(null!=(r=y)&&null!=(r=r.spaViewModel)?r.abTestCohorts:r)||"{}";return a.a.createElement(o.c,{to:[C.a]},i=>a.a.createElement(u.a,null,({featureFlags:n})=>{let s=Number(n["confluence.frontend.fabric.editor.satisfaction.survey.delay"]);(!s||s<1)&&(s=1);const o=24*s*60*60*1e3;if(this.lastSubmitted<Date.now()-o){const{contentId:s,hasBeenSubmitted:o}=i.state,r=Boolean(n["confluence.frontend.fabric.editor.satisfaction.survey"]),u=t||function(e){try{return"control"===JSON.parse(e)["fabric.editor.blank.blogpost"]}catch(e){return!1}}(f),c=Boolean(s)&&s===e&&r&&u;return a.a.createElement(O,{contentType:p,contentId:e,blueprintType:m,hasBeenSubmitted:o,isFabricPage:t,shouldShowSurvey:c,wasTinyMCEPageJustPublished:this.wasTinyMCEPageJustPublished,markSubmitted:i.markSurveySubmitted,markLastSubmitted:E,openSurvey:i.setContentId,closeSurvey:i.resetState,testCohorts:S,experimentFeatures:f})}return null}))}))}}q.displayName="EditorSatisfactionSurvey"},fDrt:function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));var n=i("ERkP"),s=i.n(n),a=i("ZVoB");const o=()=>null,r=({attribution:e,children:t,onError:i})=>s.a.createElement(a.a,{attribution:e,renderOnError:o,onError:i},t);r.displayName="TransparentErrorBoundary"},ntAl:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var n=i("RfuI");const s=Object(n.a)({name:"SatisfactionSurvey",loader:()=>Promise.all([i.e("atlaskit~66e23772"),i.e("vendors~4134d62c"),i.e(8),i.e("satisfaction-survey~b59ad437")]).then(i.bind(null,"8jqM")).then(({SatisfactionSurvey:e})=>e),loading:()=>null})},xXmr:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var n=i("zjfJ"),s=i("lZoD");const a={contentId:null,hasBeenSubmitted:!1};class o extends s.a{constructor(...e){super(...e),Object(n.a)(this,"state",a),Object(n.a)(this,"setContentId",e=>{e&&this.setState({contentId:e})}),Object(n.a)(this,"markSurveySubmitted",()=>{this.setState({hasBeenSubmitted:!0})}),Object(n.a)(this,"resetState",()=>{this.setState(a)})}}}}]);
//# sourceMappingURL=editor-satisfaction-survey~dade3008.Q17t7Kh4-v39.js.map