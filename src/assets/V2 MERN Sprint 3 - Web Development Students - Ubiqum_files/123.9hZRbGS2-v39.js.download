(window.webpackJsonp=window.webpackJsonp||[]).push([[123],{GFmV:function(e,n,t){"use strict";t.d(n,"e",(function(){return i})),t.d(n,"d",(function(){return c})),t.d(n,"a",(function(){return s})),t.d(n,"c",(function(){return l})),t.d(n,"f",(function(){return u})),t.d(n,"b",(function(){return d}));const r="createBlankFabricPage",a="parentPageId",o="spaceKey",i=e=>{const n=e[r];return"string"==typeof n?"true"===n:!!n},c=e=>{const n={};return e[a]&&(n.parentPageId=e[a]),e[o]&&(n.spaceKey=e[o]),n},s=(e,n={})=>({[r]:e||null,[a]:n.parentPageId||null,[o]:n.spaceKey||null}),l=e=>{const n=e["confluence.frontend.fabric.editor.blank.page"]||e["confluence.frontend.fabric.editor.all-pages"],t=e["confluence.frontend.in-editor-templates"];return n&&t},u=(e,n)=>{var t,r,a;if((null!=(a=e)&&null!=(a=a.content)&&null!=(a=a.nodes)&&null!=(a=a[0])&&null!=(a=a.space)?a.key:a)!==n)return!1;if("page"!==(null!=(r=e)&&null!=(r=r.content)&&null!=(r=r.nodes)&&null!=(r=r[0])?r.type:r))return!1;const o=null!=(t=e)&&null!=(t=t.content)&&null!=(t=t.nodes)&&null!=(t=t[0])?t.operations:t;return!!(o&&o.find(e=>"page"===e.targetType&&"create"===e.operation))},d=(e,n)=>({value:e||n,usedOverride:!!e})},"T+Mg":function(e,n,t){"use strict";t.d(n,"a",(function(){return l}));var r=t("cxan"),a=t("zjfJ"),o=t("ERkP"),i=t.n(o),c=t("lZoD"),s=t("qhEF");function l(e){var n,t;return t=n=class extends o.Component{render(){return i.a.createElement(c.c,{to:[s.a]},n=>i.a.createElement(e,Object(r.a)({},this.props,{flags:n})))}},Object(a.a)(n,"displayName","withFlags(".concat(e.displayName||e.name,")")),t}},Xmxh:function(e,n,t){"use strict";t.r(n);var r=t("ERkP"),a=t.n(r),o=t("T+Mg"),i=t("+mzV"),c=t("Ua4J"),s=t("GFmV"),l=t("zjfJ"),u=t("L21V"),d=t("IC1n"),p=t.n(d),g=t("Ydxy"),b=t("X2PC"),f=t("hpu0"),m=t("3VMZ"),y=t("8TdO"),h=t("BX6b");const P=Object(u.g)({errorTitle:{id:"create-blank-fabric-page.error.title",description:"title for all error flags created by create-blank-fabric-page",defaultMessage:"We can’t create a page for you"},invalidPermissions:{id:"create-blank-fabric-page.error.invalid-permissions",description:"error message when they cant create in any space",defaultMessage:"You don’t have the right permissions; talk to your admin about adjusting them."},pageCreationError:{id:"create-blank-fabric-page.error.page-creation-error",description:"error message when the page creation endpoint errors or doesnt return a link to follow",defaultMessage:"Refresh the page and try again. If this keeps happening, contact Support."}});var O=t("KD1n"),E=t("KsTJ"),j=t("RZTm"),k=t("dDc+");function v(){const e=Object(O.a)(["\n  position: fixed;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n"]);return v=function(){return e},e}function C(){const e=Object(O.a)(["\n  z-index: ",";\n  height: 100%;\n  width: 100%;\n  position: fixed;\n  left: 0;\n  top: 0;\n  background-color: ",";\n  opacity: 0.54;\n  transition: opacity 0.2s;\n  transition-delay: 0.1s;\n"]);return C=function(){return e},e}const w=E.default.div(C(),j.m.blanket,k.colors.N900),S=E.default.div(v());var K=t("H5qd"),x=t.n(K);function F(){const e=Object(O.a)(["\n  mutation CreateBlankFabricPageQuery($spaceKey: String!, $parentPage: String)\n    @experimental {\n    experimentalCreateBlankFabricPage(\n      spaceKey: $spaceKey\n      parentPage: $parentPage\n    ) {\n      links {\n        draftUrl\n      }\n    }\n  }\n"]);return F=function(){return e},e}const I=x()(F());function B(){const e=Object(O.a)(["\n  query GetPromotedSpacesQuery($promotedSpaceKey: String) @experimental {\n    experimentalPromotedSpaces(\n      promotedSpacesLimit: 1\n      otherSpacesLimit: 1\n      promotedSpaceKey: $promotedSpaceKey\n    ) {\n      nodes {\n        id\n      }\n    }\n  }\n"]);return B=function(){return e},e}const T=x()(B());function A(){const e=Object(O.a)(["\n  query ParentPageQuery($contentId: ID) {\n    content(id: $contentId) {\n      nodes {\n        id\n        type\n        operations {\n          operation\n          targetType\n        }\n        space {\n          id\n          key\n        }\n      }\n    }\n  }\n"]);return A=function(){return e},e}const M=x()(A());class R extends Error{}const q=Object(u.h)(class extends r.PureComponent{constructor(...e){super(...e),Object(l.a)(this,"handleError",e=>{const{flags:n,intl:t,onError:r}=this.props;n.showErrorFlag({title:t.formatMessage(P.errorTitle),description:t.formatMessage(e)}),r()}),Object(l.a)(this,"handleCreationError",e=>{Object(f.a)().fail({name:m.a.CREATE_PAGE,error:e}),Object(h.a)().submitError(e,{attribution:b.a.TAILORED_EXPERIENCES}),this.handleError(P.pageCreationError)}),Object(l.a)(this,"handlePermissionsError",e=>{Object(f.a)().abort({name:m.a.CREATE_PAGE,reason:e.message}),this.handleError(P.invalidPermissions)}),Object(l.a)(this,"createBlankPage",async e=>{var n;return(null!=(n=(await Object(y.getApolloClient)().mutate({mutation:I,variables:e})).data)&&null!=(n=n.experimentalCreateBlankFabricPage)&&null!=(n=n.links)?n.draftUrl:n)||""}),Object(l.a)(this,"getSpaceKeyForCreation",async()=>{var e;const{currentSpaceKey:n,creationOverrides:t}=this.props,{value:r,usedOverride:a}=Object(s.b)(t.spaceKey,n),o={promotedSpaceKey:r},i=null!=(e=(await Object(y.getApolloClient)().query({query:T,variables:o})).data)&&null!=(e=e.experimentalPromotedSpaces)&&null!=(e=e.nodes)&&null!=(e=e[0])?e.id:e;if(i){if(a&&i!==r)throw new R("invalid space used as override");return i}throw new R("no spaces for creation")}),Object(l.a)(this,"getParentPageIdForCreation",async e=>{const{currentParentPageId:n,creationOverrides:t}=this.props,{value:r,usedOverride:a}=Object(s.b)(t.parentPageId,n);if(!r)return null;const o={contentId:r},i=(await Object(y.getApolloClient)().query({query:M,variables:o})).data;if(Object(s.f)(i,e))return r;if(!a)return null;throw new R("invalid parent page used as override")}),Object(l.a)(this,"buildBlankPageMutationVariables",async()=>{const e=await this.getSpaceKeyForCreation();return{spaceKey:e,parentPage:await this.getParentPageIdForCreation(e)}}),Object(l.a)(this,"createBlankFabricPage",async()=>{try{Object(f.a)().start({name:m.a.CREATE_PAGE,id:p()()});const e=await this.buildBlankPageMutationVariables(),n=await this.createBlankPage(e);this.props.onSuccess(n),Object(f.a)().succeed({name:m.a.CREATE_PAGE})}catch(e){e instanceof R?this.handlePermissionsError(e):this.handleCreationError(e)}})}componentDidMount(){this.createBlankFabricPage()}render(){return a.a.createElement(w,null,a.a.createElement(S,null,a.a.createElement(g.a,{size:"xlarge"})))}});var V=t("gQ5V");class $ extends r.PureComponent{render(){const{currentSpaceKey:e}=this.props;return a.a.createElement(V.b,{query:T,variables:{promotedSpaceKey:e}},()=>null)}}$.displayName="CreateBlankFabricPageDataPreloader",t.d(n,"CreateBlankFabricPageListener",(function(){return G}));const D=({flags:e})=>{const{setQueryParams:n,getQueryParams:t,push:o}=Object(r.useContext)(c.a),{spaceKey:l,contentId:u}=Object(r.useContext)(i.a),d=Object(r.useCallback)(()=>{n(Object(s.a)(!1,{}),!0)},[n]),p=Object(r.useCallback)(e=>{d(),o(e)},[o,d]),g=t(),b=Object(s.d)(g),f=Object(s.e)(g);return a.a.createElement(a.a.Fragment,null,a.a.createElement($,{currentSpaceKey:l}),f&&a.a.createElement(q,{flags:e,currentSpaceKey:l,currentParentPageId:"string"==typeof u?u:null,creationOverrides:b,onError:d,onSuccess:p}))};D.displayName="CreateBlankFabricPageListenerBase";const G=Object(o.a)(Object(r.memo)(D))}}]);
//# sourceMappingURL=123.9hZRbGS2-v39.js.map