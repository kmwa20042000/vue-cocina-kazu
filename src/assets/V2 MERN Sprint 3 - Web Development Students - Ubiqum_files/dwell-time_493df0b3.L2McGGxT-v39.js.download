(window.webpackJsonp=window.webpackJsonp||[]).push([["dwell-time~493df0b3"],{"093b":function(e,t,a){"use strict";a.r(t);var s=a("cxan"),n=a("zjfJ"),r=a("uDfI"),c=a("ERkP"),i=a.n(c),l=a("gQ5V"),o=a("kR5U"),u=a("bQlP"),d=a("Ua4J"),p=a("+mzV"),b=a("2wFc"),h=a("pkwY"),w=a("KD1n"),m=(a("aWzz"),a("r9hL")),j=a("2sr0"),T=a("xBRb"),g=a("cGYM"),O=a("++l3"),D=a("daKX"),E=a("CwyC"),y=a("d3tz"),f=a("3VMZ"),I=a("hpu0");function P(){const e=Object(w.a)(["dwell page loaded within "," seconds"]);return P=function(){return e},e}const k=Object(D.a)("DwellTime:LastPageTracker");class S{constructor(){Object(n.a)(this,"onExperienceEvent",e=>{"taskSuccess"===e.action&&e.name===f.a.VIEW_PAGE&&(k.debug(P(),e.duration),this.onViewPageEnd(e))}),Object(n.a)(this,"onViewPageEnd",e=>{this.lastSuccessfulPage=e}),Object(n.a)(this,"getLastSuccessfulPage",()=>this.lastSuccessfulPage),this.experienceTracker=Object(I.a)(),this.unsubscribeFromExperienceTracker=null,this.lastSuccessfulPage=null}start(){this.unsubscribeFromExperienceTracker=this.experienceTracker.subscribe(this.onExperienceEvent)}stop(){this.unsubscribeFromExperienceTracker&&this.unsubscribeFromExperienceTracker()}}function v(){const e=Object(w.a)(["adjusted dwell time "," for contentId "," instead of ",""]);return v=function(){return e},e}function H(){const e=Object(w.a)(["lastPage ",""]);return H=function(){return e},e}const C=Object(D.a)("DwellTime");class x extends c.Component{constructor(...e){super(...e),Object(n.a)(this,"onInitialLoad",()=>{this.startDwell()}),Object(n.a)(this,"onPageTransition",()=>{this.startDwell()}),Object(n.a)(this,"stripSearchIdFromUrl",()=>{const{getQueryParams:e,setQueryParams:t}=this.props,a=e().search_id;return a?(t({search_id:null},!0),a):null}),Object(n.a)(this,"sendGasV2",e=>{const t={dwellTime:e.attributes.dwellTime,finalDwellEvent:e.attributes.finalDwellEvent,searchReferrerId:Object(g.a)(e.attributes.searchReferrer),contentId:e.actionSubjectId};this.props.triggerAnalytics("dwell",t)}),Object(n.a)(this,"sendGasV3",e=>{!e.attributes.finalDwellEvent&&e.attributes.dwellTime<=6e4&&(e.attributes.navdexPointType=e.attributes.dwellTime<4e4?T.a.TOUCH:T.a.END);const t=this.adjustDuration(e);this.props.createAnalyticsEvent({type:"sendTrackEvent",data:t}).fire()}),Object(n.a)(this,"adjustDuration",e=>{const{lastPageTracker:t}=this.props,a=t.getLastSuccessfulPage();C.debug(H(),a);const s=a&&a.id===e.objectId?e.attributes.dwellTime-a.duration:void 0,n=Object(h.a)({},e,{attributes:Object(h.a)({},e.attributes,{dwellTimeWithoutLoad:s})});return C.debug(v(),s,e.objectId,e.attributes.dwellTime),n}),Object(n.a)(this,"sendDwellEvent",e=>{this.sendGasV2(e),this.sendGasV3(e)})}componentDidMount(){this.props.isSearchAttributionEnabled&&this.onInitialLoad()}shouldComponentUpdate(e){return e.contentIdState===O.a&&(this.props.spaceId!==e.spaceId||this.props.contentId!==e.contentId)}componentDidUpdate(){this.props.isSearchAttributionEnabled&&this.onPageTransition()}async componentWillUnmount(){(await Object(E.a)()).stop()}async startDwell(){const{isSpace:e,spaceId:t,contentId:a}=this.props,s=await Object(E.a)(),n=this.stripSearchIdFromUrl();e?s.startSpace(t,this.sendDwellEvent,n):s.startPage(t,a,this.sendDwellEvent,n)}render(){return null}}x.displayName="DwellTimeComponentClass";var F=Object(j.a)()(Object(m.b)(y.a.VIEW_PAGE)(x)),V=a("H5qd");function U(){const e=Object(w.a)(["\n  query DwellTimeQuery($spaceKey: String) {\n    space(key: $spaceKey) {\n      id\n      key\n    }\n  }\n"]);return U=function(){return e},e}const K=a.n(V)()(U());class Q extends c.Component{constructor(){super(),Object(n.a)(this,"spaceIdInData",e=>e&&e.space&&e.space.id),this.lastPageTracker=new S,this.lastPageTracker.start()}componentWillUnmount(){this.lastPageTracker.stop()}render(){return i.a.createElement(d.a.Consumer,null,({getQueryParams:e,setQueryParams:t,location:a})=>i.a.createElement(p.a.Consumer,null,({spaceKey:n,contentId:r,contentIdState:c})=>n&&r&&i.a.createElement(l.b,{query:K,variables:{spaceKey:n}},({data:n,loading:l})=>l||!this.spaceIdInData(n)?null:i.a.createElement(F,Object(s.a)({},this.props,{spaceId:n.space.id,contentId:r,contentIdState:c,getQueryParams:e,setQueryParams:t,isSpace:Object(b.r)(a),lastPageTracker:this.lastPageTracker})))))}}Q.displayName="DwellTime";t.default=Object(r.connect)(e=>({isSearchAttributionEnabled:Object(o.b)(e,u.u)}))(Q)},CwyC:function(e,t,a){"use strict";var s=a("lSUb"),n=a("KkZ4"),r=a("KD1n"),c=a("zjfJ"),i=a("BX6b"),l=a("daKX");function o(){const e=Object(r.a)(["Failed to start dwell time"]);return o=function(){return e},e}function u(){const e=Object(r.a)(["Dwell was stopped before it can get started"]);return u=function(){return e},e}const d=Object(l.a)("DwellTimeTracker");class p{constructor(e){Object(c.a)(this,"provideDwellTimeHelper",void 0),Object(c.a)(this,"dwellTimeHelper",null),Object(c.a)(this,"dwellTimeCallback",null),Object(c.a)(this,"onDwell",e=>{this.dwellTimeCallback&&this.dwellTimeCallback(e)}),Object(c.a)(this,"getEventDataForPage",(e,t)=>({containerType:"space",containerId:e,objectType:"page",objectId:t,source:"page",actionSubject:"page",actionSubjectId:t})),Object(c.a)(this,"getEventDataForSpace",e=>({containerType:"space",containerId:e,source:"space",actionSubject:"space",actionSubjectId:e})),this.provideDwellTimeHelper=e}async startAny(e,t){this.startDwellTimeHelper(e,t)}async startPage(e,t,a,s){const n=this.getEventDataForPage(e,t);this.startDwellTimeHelper(n,a,s)}async startSpace(e,t,a){const s=this.getEventDataForSpace(e);this.startDwellTimeHelper(s,t,a)}stop(){this.dwellTimeHelper?this.dwellTimeHelper.stop():d.error(u())}async startDwellTimeHelper(e,t,a){try{this.dwellTimeHelper?this.dwellTimeHelper.newPage(e,a):(this.dwellTimeHelper=this.provideDwellTimeHelper(this.onDwell,e,a),this.dwellTimeHelper.stop(),this.dwellTimeHelper.start()),this.dwellTimeCallback=t}catch(e){throw d.error(o()),Object(i.a)().submitError(e,{attribution:"disco"}),e}}}a.d(t,"a",(function(){return b}));const b=Object(s.a)(async()=>{const e=await Object(n.getDwellTimeHelper)();return new p((t,a,s)=>new e(t,a,s))})}}]);
//# sourceMappingURL=dwell-time~493df0b3.L2McGGxT-v39.js.map